<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wellcoaches â€“ Nine Perspectives</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Wellcoaches â€“ Nine Perspectives</h1>
      <p class="subtitle">Explore your reflection through multiple cognitive lenses</p>
    </div>

    <div class="card">
      <h2>Begin Your Reflection</h2>
      <form action="/ask" method="post" id="promptForm">
        <label for="prompt" class="form-label">What would you like to explore?</label>
        <textarea
          id="prompt"
          name="prompt"
          rows="5"
          placeholder="e.g., How can I stay motivated when my team is facing challenges?"
          required
        ></textarea>

        <div class="options">
          <label>
            <input type="checkbox" name="blindspot" value="true" />
            Include blindspot analysis
          </label>
        </div>

        <button type="submit" class="button primary">Generate Insights â†’</button>
      </form>
    </div>

    <div class="how-it-works card">
      <h2>How It Works</h2>
      <ul>
        <li>Analyze your reflection through the Wellcoaches â€œNine Perspectives.â€</li>
        <li>Receive key insights, blind spots, and a synthesis summary.</li>
        <li>Click â€œDeepen this Perspectiveâ€ to explore further.</li>
        <li>Use â€œContinue Your Reflectionâ€ to build on your inquiry collaboratively.</li>
      </ul>
    </div>

  </div>

  <!-- ğŸŒ¿ Reflective Loading Modal -->
<div id="loadingModal" class="modal hidden">
  <div class="modal-content">
    <div class="pulse-bg"></div>
    <div class="modal-inner">
      <h2 class="modal-title breathe">ğŸŒ¿ Reflecting with Wellcoaches AI</h2>
      <p id="statusMessages" class="status-messages">Gathering your perspectivesâ€¦</p>
      <p id="affirmation" class="affirmation hidden">Youâ€™re taking a thoughtful step forward.</p>
    </div>
  </div>
</div>

<script>
  const modal = document.getElementById('loadingModal');
  const statusBox = document.getElementById('statusMessages');
  const affirmation = document.getElementById('affirmation');

  const messages = [
    "ğŸ§­ Gathering your perspectivesâ€¦",
    "ğŸ” Listening for hidden blind spotsâ€¦",
    "ğŸ’¡ Synthesizing insights with Claudeâ€¦",
    "ğŸ§˜ Weaving it all togetherâ€¦",
    "âœ¨ Finalizing your reflectionâ€¦"
  ];

  const affirmations = [
    "Youâ€™re taking a thoughtful step forward.",
    "Deep reflection brings deeper clarity.",
    "Insight grows when we pause and listen.",
    "Your curiosity is leading the way.",
    "Sometimes slowing down is how we move forward."
  ];

  let messageIndex = 0;
  let messageInterval;
  let affirmationTimeout;

  function showLoadingModal() {
    modal.classList.remove('hidden');
    statusBox.textContent = messages[0];
    messageIndex = 1;

    // Cycle progress messages
    messageInterval = setInterval(() => {
      statusBox.style.opacity = 0;
      setTimeout(() => {
        statusBox.textContent = messages[messageIndex];
        statusBox.style.opacity = 1;
        messageIndex = (messageIndex + 1) % messages.length;
      }, 400);
    }, 2500);

    // Show default affirmation after ~6 seconds
    affirmationTimeout = setTimeout(() => {
      affirmation.classList.remove('hidden');
      affirmation.textContent =
        affirmations[Math.floor(Math.random() * affirmations.length)];
    }, 6000);

    // ğŸŒ¿ AI-enhanced affirmation (nested properly)
    const promptText = document.getElementById('prompt')?.value || '';
    fetch('/affirmation', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt: promptText }),
    })
      .then((res) => res.json())
      .then((data) => {
        setTimeout(() => {
          affirmation.classList.remove('hidden');
          affirmation.textContent = data.affirmation;
        }, 6000);
      })
      .catch(() => {});
  }

  function hideLoadingModal() {
    modal.classList.add('hidden');
    clearInterval(messageInterval);
    clearTimeout(affirmationTimeout);
    affirmation.classList.add('hidden');
  }

  // âœ… Show modal for any form submission (first prompt, reflection, etc.)
  document.querySelectorAll('form').forEach((form) => {
    form.addEventListener('submit', () => {
      showLoadingModal();
    });
  });

  // âœ… Hook into "Deepen this Perspective" buttons (the /expand fetch calls)
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('expand-btn')) {
      showLoadingModal();
    }
  });

  // âœ… Hide modal automatically when new page loads
  window.addEventListener('pageshow', () => {
    hideLoadingModal();
  });
</script>

</body>
</html>
