<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nine Perspectives Result</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Wellcoaches ‚Äì Nine Perspectives</h1>
      <p class="subtitle">Comprehensive cognitive perspectives with synthesis</p>
    </div>

    <div class="card">
      <h2>Your Prompt</h2>
      <p class="input-text">{{userPrompt}}</p>

      <h2>Synthesis</h2>
      <div class="synthesis">{{claudeOutput}}</div>

      {{exploreSection}}
    </div>

    <!-- Section where all perspectives are listed -->
    <div id="perspectives-container" class="results"></div>

    <div class="reflection">
      <a href="/" class="button secondary">‚Üê Back</a>
    </div>

    <footer class="footer">
      Powered by GPT-5 + Claude 3.5 | ¬© 2025 Wellcoaches.ai
    </footer>
  </div>

  <script>
    // -----------------------------------------------
    // Inject server-passed perspectives (if available)
    // -----------------------------------------------
    const perspectivesData = {{perspectivesJSON}};
    const showBlindspots = '{{showBlindspots}}';
    const container = document.getElementById('perspectives-container');

    if (Array.isArray(perspectivesData) && perspectivesData.length > 0) {
      perspectivesData.forEach(p => {
        const div = document.createElement('div');
        div.classList.add('perspective');
        div.innerHTML = `
          <h3>${p.name}</h3>
          <p><strong>Insight:</strong> ${p.insight || "(No insight provided)"} </p>
          <p class="blindspot" style="display: ${showBlindspots};">
            <strong>Blind Spot:</strong> ${p.blindspot || "(Not applicable in this mode)"}
          </p>
          <button class="expand-btn" data-name="${p.name}">Deepen this Perspective</button>
          <div class="expand-output"></div>
        `;
        container.appendChild(div);
      });
    } else {
      // üëá Show a friendly message when Quick Blindspot mode is active
      const summaryBlock = document.createElement('div');
      summaryBlock.classList.add('summary-card');
      summaryBlock.innerHTML = `
        <h3>Blindspot Summary</h3>
        <p>In Quick Blindspot Check mode, you‚Äôll only see dominant and missing perspectives above.</p>
        <p>Full nine-perspective insights are available when you uncheck ‚ÄúRun a Quick Blindspot Check.‚Äù</p>
      `;
      container.appendChild(summaryBlock);
    }

    // -----------------------------------------------
    // Handle "Deepen this Perspective" interactions
    // -----------------------------------------------
    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('expand-btn')) {
        const button = e.target;
        const perspective = button.dataset.name;
        const prompt = "{{userPrompt}}";
        const outputDiv = button.nextElementSibling;

        if (outputDiv.style.display === 'block') {
          outputDiv.style.display = 'none';
          return;
        }

        button.textContent = 'Loading...';
        try {
          const res = await fetch('/expand', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt, perspective })
          });
          const data = await res.json();
          outputDiv.textContent = data.expanded || '(No response)';
          outputDiv.style.display = 'block';
        } catch {
          outputDiv.textContent = 'Error expanding perspective.';
          outputDiv.style.display = 'block';
        }
        button.textContent = 'Deepen this Perspective';
      }
    });
  </script>
</body>
</html>
